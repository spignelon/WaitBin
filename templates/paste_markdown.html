{% extends "base.html" %}

{% block title %}Paste - {{ endpoint }}{% endblock %}

{% block content %}
<!-- Include marked.js for markdown parsing -->
<script src="https://cdn.jsdelivr.net/npm/marked@11.1.0/marked.min.js"></script>
<!-- Include highlight.js for code syntax highlighting -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<div class="max-w-6xl mx-auto px-4">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6">
        <h1 class="text-3xl font-bold">Markdown View</h1>
        <div class="flex gap-2 flex-wrap">
            <a href="{{ url_for('view_paste', paste_endpoint=endpoint) }}" class="btn btn-sm btn-outline">
                ðŸ“„ Plain Text
            </a>
            <button onclick="copyRawContent()" class="btn btn-sm btn-primary">
                ðŸ“‹ Copy Raw
            </button>
        </div>
    </div>
    
    <div class="card bg-base-100 shadow-xl">
        <div class="card-body p-6 sm:p-8" style="background-color: #0d1117;">
            <div id="markdown-content" class="markdown-body"></div>
        </div>
    </div>
    
    <div class="mt-4 text-sm opacity-70 text-center">
        <p>Endpoint: <code>/paste-md/{{ endpoint }}</code></p>
    </div>
</div>

<textarea id="raw-content" style="position: absolute; left: -9999px;">{{ raw_content }}</textarea>

<script>
// Configure marked options
marked.setOptions({
    breaks: true,
    gfm: true,
    headerIds: true,
    mangle: false,
    sanitize: false,
    highlight: function(code, lang) {
        if (lang && hljs.getLanguage(lang)) {
            try {
                return hljs.highlight(code, { language: lang }).value;
            } catch (err) {}
        }
        return hljs.highlightAuto(code).value;
    }
});

// Get the raw content and render it
const rawContent = document.getElementById('raw-content').value;
const renderedHTML = marked.parse(rawContent);
document.getElementById('markdown-content').innerHTML = renderedHTML;

function copyRawContent() {
    const rawContent = document.getElementById('raw-content');
    rawContent.select();
    document.execCommand('copy');
    
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = 'âœ… Copied!';
    setTimeout(() => {
        btn.innerHTML = originalText;
    }, 2000);
}
</script>

<style>
/* GitHub-style markdown rendering */
.markdown-body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    word-wrap: break-word;
    color: #c9d1d9;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
    margin-top: 24px;
    margin-bottom: 16px;
    font-weight: 600;
    line-height: 1.25;
}

.markdown-body h1 {
    font-size: 2em;
    border-bottom: 1px solid #30363d;
    padding-bottom: 0.3em;
}

.markdown-body h2 {
    font-size: 1.5em;
    border-bottom: 1px solid #30363d;
    padding-bottom: 0.3em;
}

.markdown-body h3 {
    font-size: 1.25em;
}

.markdown-body h4 {
    font-size: 1em;
}

.markdown-body h5 {
    font-size: 0.875em;
}

.markdown-body h6 {
    font-size: 0.85em;
    color: #8b949e;
}

.markdown-body p {
    margin-top: 0;
    margin-bottom: 16px;
}

.markdown-body ul,
.markdown-body ol {
    margin-top: 0;
    margin-bottom: 16px;
    padding-left: 2em;
}

.markdown-body ul {
    list-style-type: disc;
}

.markdown-body ol {
    list-style-type: decimal;
}

.markdown-body li {
    margin-top: 0.25em;
}

.markdown-body li + li {
    margin-top: 0.25em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
    margin-top: 0;
    margin-bottom: 0;
}

.markdown-body blockquote {
    margin: 0 0 16px 0;
    padding: 0 1em;
    color: #8b949e;
    border-left: 0.25em solid #30363d;
}

.markdown-body blockquote > :first-child {
    margin-top: 0;
}

.markdown-body blockquote > :last-child {
    margin-bottom: 0;
}

.markdown-body code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 85%;
    background-color: rgba(110, 118, 129, 0.4);
    border-radius: 6px;
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
}

.markdown-body pre {
    margin-top: 0;
    margin-bottom: 16px;
    padding: 16px;
    overflow: auto;
    font-size: 85%;
    line-height: 1.45;
    background-color: #161b22;
    border-radius: 6px;
}

.markdown-body pre code {
    display: inline;
    padding: 0;
    margin: 0;
    overflow: visible;
    line-height: inherit;
    word-wrap: normal;
    background-color: transparent;
    border: 0;
}

.markdown-body table {
    border-spacing: 0;
    border-collapse: collapse;
    display: block;
    width: max-content;
    max-width: 100%;
    overflow: auto;
    margin-top: 0;
    margin-bottom: 16px;
}

.markdown-body table th,
.markdown-body table td {
    padding: 6px 13px;
    border: 1px solid #30363d;
}

.markdown-body table tr {
    background-color: transparent;
    border-top: 1px solid #30363d;
}

.markdown-body table tr:nth-child(2n) {
    background-color: rgba(110, 118, 129, 0.1);
}

.markdown-body table th {
    font-weight: 600;
    background-color: rgba(110, 118, 129, 0.2);
}

.markdown-body img {
    max-width: 100%;
    box-sizing: content-box;
    background-color: transparent;
    border-radius: 6px;
}

.markdown-body a {
    color: #58a6ff;
    text-decoration: none;
}

.markdown-body a:hover {
    text-decoration: underline;
}

.markdown-body hr {
    height: 0.25em;
    padding: 0;
    margin: 24px 0;
    background-color: #30363d;
    border: 0;
}

.markdown-body strong {
    font-weight: 600;
}

.markdown-body em {
    font-style: italic;
}

.markdown-body del {
    text-decoration: line-through;
}

/* Task list styles */
.markdown-body input[type="checkbox"] {
    margin: 0 0.2em 0.25em -1.6em;
    vertical-align: middle;
}

/* Code block scrollbar styling */
.markdown-body pre::-webkit-scrollbar {
    height: 8px;
}

.markdown-body pre::-webkit-scrollbar-track {
    background: #0d1117;
}

.markdown-body pre::-webkit-scrollbar-thumb {
    background: #30363d;
    border-radius: 4px;
}

.markdown-body pre::-webkit-scrollbar-thumb:hover {
    background: #484f58;
}
</style>
{% endblock %}
